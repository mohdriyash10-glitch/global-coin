<!DOCTYPE html>
<html>
<head>
  <title>GlobalCoin Wallet</title>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: white; text-align: center; padding: 20px; }
    input, button { padding: 10px; margin: 10px; font-size: 16px; }
    #walletSection { display: none; }
  </style>
</head>
<body>
  <h1>üåê GlobalCoin Wallet</h1>

  <div id="loginSection">
    <h2>Login with Phone</h2>
    <input type="text" id="phoneNumber" placeholder="+91XXXXXXXXXX" /><br>
    <div id="recaptcha-container"></div>
    <button onclick="sendOTP()">Send OTP</button><br>

    <input type="text" id="otp" placeholder="Enter OTP" style="display:none;" />
    <button onclick="verifyOTP()" style="display:none;" id="verifyBtn">Verify</button>
  </div>

  <div id="walletSection">
    <h2>Welcome to GlobalCoin Wallet</h2>
    <p><b>Wallet Address:</b> <span id="walletAddress"></span></p>
    <p><b>Balance:</b> <span id="balance">0 GLBC</span></p>

    <!-- Add send/receive/mining UI below -->
    <button onclick="sendCoin()">Send Coin</button>
    <button onclick="receiveCoin()">Receive Coin</button>
  </div>

  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBL4ElX_vSnf_g0CfL52KB8r3XqQedPQrw",
      authDomain: "globalcoin-wallet.firebaseapp.com",
      databaseURL: "https://globalcoin-wallet-default-rtdb.firebaseio.com",
      projectId: "globalcoin-wallet",
      storageBucket: "globalcoin-wallet.appspot.com",
      messagingSenderId: "401955845745",
      appId: "1:401955845745:web:7feef43d47533e51448dd0"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    let confirmationResult;
    const auth = firebase.auth();
    const database = firebase.database();

    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      'size': 'normal',
      'callback': (response) => {}
    });
    recaptchaVerifier.render();

    function sendOTP() {
      const phoneNumber = document.getElementById('phoneNumber').value;
      auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
        .then((result) => {
          confirmationResult = result;
          document.getElementById('otp').style.display = 'inline';
          document.getElementById('verifyBtn').style.display = 'inline';
          alert("OTP sent!");
        }).catch((error) => {
          alert("Error: " + error.message);
        });
    }

    function verifyOTP() {
      const code = document.getElementById('otp').value;
      confirmationResult.confirm(code).then((result) => {
        const user = result.user;
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('walletSection').style.display = 'block';
        const uid = user.uid;
        document.getElementById('walletAddress').innerText = uid;

        // Fetch or create user balance
        const balanceRef = database.ref('users/' + uid + '/balance');
        balanceRef.once('value').then(snapshot => {
          if (!snapshot.exists()) {
            balanceRef.set(0);
            document.getElementById('balance').innerText = '0 GLBC';
          } else {
            document.getElementById('balance').innerText = snapshot.val() + ' GLBC';
          }
        });
      }).catch((error) => {
        alert("Incorrect OTP!");
      });
    }

    function sendCoin() {
      alert("Send Coin logic will go here.");
    }

    function receiveCoin() {
      alert("Receive Coin logic will go here.");
    }
  </script>
</body>
</html>
